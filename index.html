<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kay & Amy's Birthday</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
  <meta name="description" content="You're invited! Come celebrate with Kay & Amy." />
  <style>
    :root{
      --bg:#faf0e1; --ink:#45413c; --soft:#fff7fb; --line:#ffd7e6; --accent:#ff86b1; --muted:#8a857f;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);font-family:Quicksand,system-ui,sans-serif;color:var(--ink);padding:20px}
    .wrap{max-width:980px;margin:0 auto}
    .hero{display:block;margin:0 auto 10px;width:min(320px,45vw);height:auto;border-radius:14px;box-shadow:0 6px 20px rgba(0,0,0,.06)}
    h1{margin:.2rem 0;color:var(--accent);text-align:center;letter-spacing:.5px}
    h2{margin:.2rem 0 1rem}
    p, label, small{color:var(--muted)}
    .sub{margin-top:0;text-align:center;color:var(--ink);opacity:.85}
    .card{background:var(--soft);border:2px solid var(--line);border-radius:18px;padding:18px;margin:16px 0;box-shadow:0 6px 14px rgba(255,134,177,.08)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .field{display:flex;flex-direction:column;gap:8px}
    input[type=text], input[type=email]{width:100%;padding:12px 14px;border:2px solid var(--line);border-radius:12px;background:#fff;outline:none;font:inherit}
    input[type=text]:focus, input[type=email]:focus{border-color:var(--accent)}
    .seg{display:inline-grid;grid-auto-flow:column;gap:8px;background:#fff;border:2px solid var(--line);border-radius:999px;padding:6px}
    .chip{border:none;background:#fff;border-radius:999px;padding:8px 14px;font-weight:600;cursor:pointer;transition:.15s}
    .chip[aria-pressed=true]{background:var(--accent);color:#fff;transform:translateY(-1px)}
    .slots{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .slot{border:2px solid var(--line);background:#fff;border-radius:999px;padding:8px 12px;cursor:pointer;font-weight:600}
    .slot.selected{background:var(--accent);color:#fff;border-color:var(--accent)}
    .slot:disabled{opacity:.45;cursor:not-allowed}
    .btn{appearance:none;border:none;background:var(--accent);color:#fff;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer;box-shadow:0 8px 16px rgba(255,134,177,.3);transition:.15s}
    .btn:disabled{opacity:.5;cursor:not-allowed;box-shadow:none}
    .btn:hover:not(:disabled){transform:translateY(-1px)}
    .help{font-size:.85rem;margin-top:6px}
    .grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    .center{text-align:center}
    .muted{color:var(--muted)}
    .foot{margin:24px 0;text-align:center;color:var(--muted);font-size:.9rem}
    @media (max-width:760px){.row{grid-template-columns:1fr}.grid3{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <main class="wrap">
    <img class="hero" src="kay-amy-polariod.png" alt="Polaroid collage of Kay & Amy" />
    <h1>YOU ARE INVITED!!</h1>
    <p class="sub">Come celebrate with Kay & Amy.</p>

    <!-- Date & Time -->
    <section class="card" aria-labelledby="dt">
      <h2 id="dt">Date & Time</h2>
      <p style="margin:.2rem 0 .6rem 0"><strong>Tuesday, September 2, 2025</strong></p>
      <small>Time slots from <strong>11:00 AM</strong> to <strong>9:00 PM</strong></small>
    </section>

    <!-- RSVP -->
    <section class="card" aria-labelledby="rsvp">
      <h2 id="rsvp">RSVP</h2>
      <div class="row">
        <div class="field">
          <label for="name">Your Name</label>
          <input id="name" type="text" placeholder="e.g., Amy Mon" autocomplete="name" />
        </div>
        <div class="field">
          <label for="email">Your Email</label>
          <input id="email" type="email" placeholder="e.g., amy@email.com" autocomplete="email" />
        </div>
      </div>

      <div class="field" style="margin-top:10px">
        <label>Will you attend?</label>
        <div class="seg" role="group" aria-label="Attend">
          <button class="chip" data-status="yes" aria-pressed="false">Yes üéâ</button>
          <button class="chip" data-status="no" aria-pressed="false">No üòî</button>
        </div>
      </div>

      <!-- Time slot selection is hidden until 'Yes' is chosen -->
      <div id="slotWrap" class="field" hidden>
        <label>Choose a time slot <span aria-hidden="true">‚è∞</span></label>
        <div class="slots" id="slots"></div>
        <small class="help">Limit 10 guests per slot. Full slots will be disabled.</small>
      </div>

      <div class="center" style="margin-top:14px">
        <button id="submit" class="btn" disabled>Submit RSVP</button>
        <div id="msg" class="help"></div>
        <small class="help">Please enter your name and email.</small>
      </div>
    </section>

    <!-- Location -->
    <section class="card" aria-labelledby="loc">
      <h2 id="loc">üìç Location</h2>
      <p>16 Freeman St, Quincy, MA 02170</p>
      <div style="border-radius:12px;overflow:hidden">
        <iframe title="Map" src="https://www.google.com/maps?q=16%20Freeman%20St%2C%20Quincy%2C%20MA%2002170&z=16&output=embed" width="100%" height="320" style="border:0"></iframe>
      </div>
    </section>

    <p class="foot">Made with ‚ô• for friends & family.</p>
  </main>

  <script>
    // ===== CONFIG =====
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwDxm8wlDsCKJIQ6GQtQ6F4sv2sZprvuhTOiEqpyqFNkLA3_hJiCy0GATQ8v7jO9qEZrg/exec"; // your Web App URL
    const SLOT_CAP = 10;
    const SLOT_TIMES = [ [11,0],[12,0],[13,0],[14,0],[15,0],[16,0],[17,0],[18,0],[19,0],[20,0] ];

    // ===== UTIL =====
    const $ = (q, el=document) => el.querySelector(q);
    const fmt12 = (h,m) => { const am = h < 12; let hh = h % 12; if(hh===0) hh=12; const mm = m.toString().padStart(2,'0'); return `${hh}:${mm} ${am?"AM":"PM"}`; };

    // ===== STATE =====
    let status = null; let selectedSlot = null;
    let counts = {}; // {"11:00": 3, ...}

    const slotWrap = $('#slotWrap'); const slotsEl = $('#slots'); const submitBtn = $('#submit'); const msg = $('#msg');

    // Build slot buttons using current counts
    function renderSlots(){
      slotsEl.innerHTML = '';
      SLOT_TIMES.forEach(([h,m]) => {
        const key = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
        const c = counts[key] || 0;
        const b = document.createElement('button');
        b.className = 'slot';
        b.type = 'button';
        b.dataset.value = key;
        b.textContent = `${fmt12(h,m)} ‚Äî ${c}/${SLOT_CAP}`;
        b.disabled = c >= SLOT_CAP;
        b.addEventListener('click', ()=>{
          document.querySelectorAll('.slot').forEach(s=>s.classList.remove('selected'));
          b.classList.add('selected');
          selectedSlot = key;
          validate();
        });
        slotsEl.appendChild(b);
      });
    }

    async function refreshCounts(){
      if(!SCRIPT_URL) return;
      try{
        const res = await fetch(`${SCRIPT_URL}?counts=1`, { method:'GET' });
        const json = await res.json();
        if(json.ok && json.counts){ counts = json.counts; }
      }catch(e){ /* ignore */ }
      renderSlots();
    }

    // Show slots only when "Yes" chosen
    document.querySelectorAll('.chip').forEach(ch =>{
      ch.addEventListener('click', async () =>{
        document.querySelectorAll('.chip').forEach(x=>x.setAttribute('aria-pressed','false'));
        ch.setAttribute('aria-pressed','true');
        status = ch.dataset.status;
        if(status === 'yes'){
          slotWrap.hidden = false;
          await refreshCounts();
        } else {
          slotWrap.hidden = true;
          selectedSlot = null;
        }
        validate();
      });
    });

    function validate(){
      const ok = $('#name').value.trim() && $('#email').value.trim() && status && (status==='no' || selectedSlot);
      submitBtn.disabled = !ok;
      msg.textContent = '';
    }
    ['input','change'].forEach(ev=>{ $('#name').addEventListener(ev, validate); $('#email').addEventListener(ev, validate); });

    // Submit RSVP
    submitBtn.addEventListener('click', async ()=>{
      const payload = { name: $('#name').value.trim(), email: $('#email').value.trim(), status, slot: status==='yes' ? selectedSlot : '' };
      submitBtn.disabled = true; submitBtn.textContent = 'Submitting‚Ä¶';
      try{
        const res = await fetch(SCRIPT_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
        const json = await res.json();
        if(!json.ok){
          if(json.error === 'FULL'){
            msg.textContent = 'That slot just filled up. Please pick another time.';
          } else {
            msg.textContent = json.error || 'Submit failed.';
          }
          msg.style.color = '#c62828';
          submitBtn.textContent = 'Submit RSVP';
          submitBtn.disabled = false;
          // Update counts if server sent them
          if(json.counts){ counts = json.counts; renderSlots(); }
          return;
        }
        // Success ‚Üí update counts live and UI
        if(json.counts){ counts = json.counts; }
        renderSlots();
        msg.textContent = 'Thank you! Your RSVP was recorded.';
        msg.style.color = '#2e7d32';
        submitBtn.textContent = 'Submitted ‚úì';
      }catch(err){
        console.error(err);
        msg.textContent = 'Oops‚Äîsomething went wrong. Please try again later.';
        msg.style.color = '#c62828';
        submitBtn.textContent = 'Submit RSVP';
        validate();
      }
    });
  </script>
</body>
</html>
